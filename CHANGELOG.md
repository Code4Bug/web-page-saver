# 更新日志

## v1.6.2 (2025-08-29)

### 功能修复
- 修复了开发者工具中未显示tab页的问题
- 增强了DevTools面板的连接稳定性和错误处理

### 修改文件
- `extension/manifest.json`: 添加了图标声明，确保扩展图标正确显示
- `extension/devtools.js`: 改进了面板创建逻辑，添加了错误检查和面板事件监听
- `extension/panel.js`: 增强了面板功能，添加了连接状态显示和更详细的调试信息
- `extension/background.js`: 改进了与devtools面板的通信机制，添加了连接状态跟踪和错误处理

### 技术细节
1. 在manifest.json中添加了图标声明，确保扩展在浏览器工具栏中正确显示
2. 在devtools.js中添加了环境检查，确保在正确的环境中创建面板
3. 在panel.js中添加了连接状态显示，用户可以清楚地知道面板是否已连接到插件
4. 在background.js中增强了与devtools面板的通信机制：
   - 添加了详细的日志记录
   - 改进了消息发送机制，包含成功/失败计数
   - 在devtools面板连接时发送初始插件状态
   - 添加了面板事件监听器
5. 添加了全面的错误处理，确保即使在部分功能失败时插件仍能正常工作

## v1.6.1 (2025-08-29)

### 错误修复
- 修复了图标设置错误：使用正确的图标文件名
- 修复了消息通道关闭前未收到响应的错误：添加了错误处理和消息发送保护
- 增强了代码的健壮性

### 修改文件
- `extension/background.js`: 修复了图标设置和消息处理相关的错误

### 技术细节
1. 修复了图标文件名错误，使用正确的 `icon.png` 而不是 `icon_active.png`
2. 添加了错误处理机制，防止在图标设置失败时抛出异常
3. 改进了devtools消息发送机制，避免向已断开的端口发送消息
4. 添加了消息发送的错误处理，防止消息通道关闭时出现错误

## v1.6.0 (2025-08-29)

### 新增功能
- 状态窗口移动到开发者工具内，作为与控制台同级的tab页签
- 创建了完整的Chrome DevTools扩展集成

### 新增文件
- `extension/devtools.html`: DevTools页面
- `extension/devtools.js`: DevTools脚本，用于创建面板
- `extension/panel.html`: 面板页面
- `extension/panel.js`: 面板脚本，用于显示信息

### 修改文件
- `extension/manifest.json`: 添加了devtools_page配置
- `extension/background.js`: 添加了与devtools面板的通信功能
- `extension/content.js`: 移除了页面底部的信息面板，因为信息现在显示在devtools中

### 技术细节
1. 创建了完整的Chrome DevTools扩展集成
2. 在开发者工具中添加了"Web Page Saver"面板
3. 面板与插件状态同步，插件激活时显示激活状态，停用时显示停用状态
4. 点击元素的信息会实时显示在devtools面板中
5. 面板支持清除功能，可以清空历史记录
6. 移除了之前在页面底部显示的信息面板

## v1.5.1 (2025-08-29)

### 功能改进
- 状态区域的显影现在由插件激活与否控制
- 插件激活时自动显示信息面板
- 插件停用时自动隐藏信息面板

### 修改文件
- `extension/content.js`: 修改了信息面板的显示逻辑，使其由插件激活状态控制

### 技术细节
1. 插件激活时自动显示信息面板
2. 插件停用时自动隐藏信息面板
3. 添加了面板折叠/展开功能
4. 优化了面板的UI设计

## v1.5.0 (2025-08-29)

### 新增功能
- 插件启动后会在当前窗口增加一个固定靠下的状态信息显示区域
- 每次点击元素时，同时会将信息展示在该区域
- 添加了信息面板的关闭功能

### 修改文件
- `extension/content.js`: 添加了固定在底部的信息显示面板，每次点击元素时会将信息展示在该区域

### 技术细节
1. 创建了一个固定在页面底部的信息显示面板
2. 面板包含元素的详细信息，如URL、标签名、ID、Class、XPath、CSS选择器、位置和大小
3. 每次点击元素时，会将元素信息添加到面板顶部
4. 添加了面板关闭按钮，用户可以隐藏面板
5. 面板支持滚动，可以显示多条历史记录

## v1.4.0 (2025-08-29)

### 新增功能
- 美化了服务器端日志，使其更加清晰易读
- 添加了彩色日志输出，不同级别的日志使用不同颜色
- 添加了详细的分隔线和格式化输出

### 修改文件
- `server/logger.go`: 新增日志格式化器，支持彩色输出和格式化
- `server/logging.go`: 更新日志配置以适应新的日志系统
- `server/server.go`: 使用新的日志格式化器替换原有日志
- `server/message.go`: 使用新的日志格式化器替换原有日志
- `server/main.go`: 使用新的日志格式化器替换原有日志

### 技术细节
1. 创建了专门的日志格式化模块，支持不同级别的日志输出
2. 添加了彩色日志输出，使日志更易于区分
3. 添加了详细的分隔线和格式化输出，提高可读性
4. 添加了调用者信息追踪，便于调试
5. 更新了所有日志调用点以使用新的日志系统

## v1.3.0 (2025-08-29)

### 新增功能
- 回传信息现在包含页面URL，便于识别元素来源页面

### 修改文件
- `server/message.go`: 在DOMInfo结构体中添加URL字段，并更新PrintDOMInfo函数以显示URL
- `extension/content.js`: 修改collectElementInfo函数，收集当前页面URL并包含在回传信息中

### 技术细节
1. 在后端DOMInfo结构体中添加了URL字段
2. 前端在收集DOM元素信息时，同时获取当前页面的URL
3. 后端在打印DOM信息时显示URL
4. 更新了相关的日志记录，包含URL信息

## v1.2.0 (2025-08-29)

### 新增功能
- 插件现在通过点击浏览器图标激活/停用，而不是自动运行
- 添加了插件状态管理功能
- 添加了插件状态通知到服务器的功能
- 添加了测试页面用于功能验证
- **完善了后端日志系统，提供更详细的运行信息**

### 修改文件
- `extension/manifest.json`: 添加了 action 配置，支持点击图标激活
- `extension/background.js`: 移除了自动连接逻辑，添加了点击图标激活功能
- `extension/content.js`: 移除了自动初始化逻辑，改为通过消息触发
- `server/server.go`: 添加了处理插件状态消息的功能
- `README.md`: 更新了使用说明和功能特性描述
- `goal.txt`: 更新了系统工作流程描述

### 新增文件
- `extension/ICONS.md`: 图标文件说明文档
- `test-page.html`: 用于测试插件功能的HTML页面
- `CHANGELOG.md`: 更新日志文件
- `server/logging.go`: 日志配置文件

### 技术细节
1. 插件默认处于未激活状态，不会自动连接到服务器
2. 用户点击浏览器插件图标后，插件激活并尝试连接到本地服务器
3. 插件激活时会向服务器发送状态通知
4. 用户再次点击图标可停用插件并断开服务器连接
5. 只有在插件激活状态下，才会处理鼠标悬停和点击事件
6. 添加了图标状态切换功能（需要添加图标文件才能看到效果）

## v1.1.1 (2025-08-29)

### 日志系统改进
- 添加了详细的日志记录功能，包括连接状态、消息处理和错误信息
- 实现了日志同时输出到控制台和文件的功能
- 添加了时间戳和文件位置信息到日志条目
- 为不同的操作类型添加了专门的日志记录点
- 创建了独立的日志配置文件 (`logging.go`)

### 日志功能详情
1. **连接日志**: 记录客户端连接尝试、成功连接和断开连接事件
2. **消息日志**: 记录接收到的消息类型、大小和内容摘要
3. **操作日志**: 记录用户命令、插件状态变化等重要操作
4. **错误日志**: 记录所有错误和异常情况
5. **文件日志**: 日志同时输出到控制台和日期命名的日志文件中
6. **详细信息**: 包含时间戳、文件位置等详细信息帮助调试

### 文件修改
- `server/main.go`: 添加日志初始化调用
- `server/server.go`: 添加详细的日志记录点
- `server/message.go`: 添加消息处理相关的日志记录
- `server/logging.go`: 新增日志配置和管理功能